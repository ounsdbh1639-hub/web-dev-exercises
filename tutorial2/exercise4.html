<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Exercise 4 - Report</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="js/shared.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Exercise 4 — Show Report</h1>
      <div class="topnav"><a href="exercise3.html">Exercise 3</a> <a href="exercise1.html">Table</a></div>
    </div>

    <div class="controls">
      <button class="btn" id="reportBtn">Show Report</button>
      <div class="info small">Click to compute totals and see chart</div>
    </div>

    <div class="chart-card hidden" id="reportCard">
      <p class="status">Total Students: <span id="total"></span> — Present: <span id="present"></span> — Participated: <span id="participated"></span></p>
      <canvas id="chart" width="600" height="260"></canvas>
    </div>
  </div>

<script>
const ctx = document.getElementById('chart').getContext('2d');
let chartInstance = null;

$('#reportBtn').on('click', function(){
  const students = Attendance.read();
  const total = students.length;
  const present = students.filter(s => s.sessions.every(v => v===true)).length;
  const participated = students.filter(s => s.parts.some(v => v===true)).length;

  $('#total').text(total);
  $('#present').text(present);
  $('#participated').text(participated);
  $('#reportCard').removeClass('hidden');

  const data = [total, present, participated];

  if(chartInstance) chartInstance.destroy();
  chartInstance = new Chart(ctx, {
    type:'bar',
    data:{
      labels:['Total','All Present','Participated'],
      datasets:[{
        label:'Attendance Report',
        data:data,
        backgroundColor: ['#3578ff','#2cc36b','#ffb020']
      }]
    },
    options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}
  });
});
</script>
</body>
</html>

<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Exercise 3 - Add Student to Table</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="js/shared.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Exercise 3 â€” Add Student to Shared Table</h1>
      <div class="topnav"><a href="exercise2.html">Exercise 2</a> <a href="exercise4.html">Exercise 4</a></div>
    </div>

    <form id="addForm">
      <div class="form-row">
        <input id="sid" placeholder="Student ID">
        <input id="first" placeholder="First Name">
        <input id="last" placeholder="Last Name">
        <button class="btn" type="submit">Add to Table</button>
      </div>
    </form>
    <p id="confirmation" class="small"></p>

    <div class="table-wrap" style="margin-top:12px">
      <table id="miniTable">
        <thead><tr><th>Last</th><th>First</th><th>Abs</th><th>Par</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

  </div>

<script>
function refreshMini(){
  const table = document.getElementById('miniTable');
  const tbody = table.tBodies[0];
  const students = Attendance.read();
  tbody.innerHTML = '';
  students.forEach(s=>{
    const r = tbody.insertRow();
    r.insertCell().textContent = s.last;
    r.insertCell().textContent = s.first;
    r.insertCell().textContent = Attendance.countAbsences ? Attendance.countAbsences(s) : s.sessions.filter(v=>!v).length;
    r.insertCell().textContent = Attendance.countParticipation ? Attendance.countParticipation(s) : s.parts.filter(v=>v).length;
  });
}

document.getElementById('addForm').addEventListener('submit', function(e){
  e.preventDefault();
  const sid = document.getElementById('sid').value.trim();
  const first = document.getElementById('first').value.trim();
  const last = document.getElementById('last').value.trim();
  if(!sid || !first || !last){ document.getElementById('confirmation').textContent = "Please fill all fields"; return; }
  // create new student with empty sessions/parts
  const obj = { id: sid, last, first, sessions:[false,false,false,false,false,false], parts:[false,false,false,false,false,false] };
  Attendance.addStudent(obj);
  document.getElementById('confirmation').textContent = "Student added successfully!";
  this.reset();
  refreshMini();
  // also refresh main table if it's open in another tab would require reload, but when user navigates it will read localStorage
});

refreshMini();
</script>
</body>
</html>

